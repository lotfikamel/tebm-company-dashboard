import{H as y,a as N,q as P,a0 as S,R as E,h as n,j as e,D as Y,F as C,g as I,x as L,m as M,w as T,t as w}from"./index-8aeefa04.js";import{u as A}from"./useMutation-1dcb797a.js";import{a as R}from"./RevenuesQueries-e1c6d87d.js";import{c as F}from"./DriversQueries-e34ad2a9.js";import"./useInfiniteQuery-bc6f39db.js";const O={driverPayDebts:"/actions/revenues/driver/pay"};function k({driverId:a,startDate:s,endDate:r}){return new Promise((t,o)=>{y.post(O.driverPayDebts,{driverId:a,startDate:s,endDate:r}).then(()=>t()).catch(i=>o(i))})}const H=()=>A(k),Q=({title:a,stat:s})=>e.jsx("div",{className:"stats shadow",children:e.jsxs("div",{className:"stat",children:[e.jsx("div",{className:"stat-title",children:a}),e.jsx("div",{className:"stat-value text-red-500",children:s})]})}),J=()=>{const a=N(),{driverId:s}=P(),[r]=S(),[t,o]=E.useState({startDate:n(r.get("startDate")).format("YYYY-MM-DD"),endDate:n(r.get("endDate")).format("YYYY-MM-DD")}),i=D=>{o(b=>({...b,[D.target.name]:D.target.value}))},{data:v,isLoading:d,isError:l,refetch:h}=R({driverId:s,startDate:t.startDate,endDate:t.endDate}),{data:u,isLoading:c,isError:m,refetch:p}=F({driverId:s}),{mutate:x,isLoading:f}=H(),g=()=>{h(),p()},j=()=>{f||x({driverId:s,startDate:n(t.startDate).toISOString(),endDate:n(t.endDate).toISOString()},{onSuccess(){a(-1)},onError(){w({message:"une erreur s'est produite."})}})};return e.jsx("div",{id:"driver-pay-debts-page",children:e.jsxs("div",{className:"container mx-auto px-4",children:[(d||c)&&e.jsx(Y,{}),!(d||c)&&(l||m)&&e.jsx(C,{tryAgain:g}),!(d||c)&&!(l||m)&&e.jsxs("div",{children:[e.jsxs("h1",{className:"mb-4 font-bold first-letter:uppercase",children:["recouvrer les dettes du chauffeur : ",e.jsx("span",{className:"text-primary",children:I(u.firstName,u.lastName)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{title:"Total des dettes",stat:L(v)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx("input",{type:"date",name:"startDate",className:"input w-full input-bordered",value:t.startDate,onChange:i})}),e.jsx("div",{children:e.jsx("input",{type:"date",name:"endDate",className:"input w-full input-bordered",value:t.endDate,onChange:i})})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"button",onClick:()=>M("confirm-alert","open"),className:"btn btn-primary",children:"règlez les dettes"})})]}),e.jsx(T,{title:"régler les dettes",text:"êtes-vous sûr de vouloir effectuer ce règlement de dettes ?",onConfirm:j})]})]})})};export{J as default};
