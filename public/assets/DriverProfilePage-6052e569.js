import{R as m,j as e,c as h,p as j,t as x,m as g,q as p,D as v,F as N,N as f,o as b,g as y,h as w,e as D,s as L,O as P,v as A}from"./index-199c3c1b.js";import{a as E}from"./DriversQueries-a5088660.js";import{u as k}from"./usePermissions-b517b115.js";import{u as I,a as C,D as R,b as z}from"./DriverStatus-3e26416c.js";import{s as M}from"./EnginesQueries-1d32232e.js";import{I as S}from"./Image-81e31aa5.js";import{C as _}from"./calendar-3e0feec3.js";import{H as q}from"./hash-db4e7d80.js";import{K as F,P as K}from"./phone-ccb760c1.js";import{S as H}from"./star-d66c6535.js";import{N as Y}from"./navigation-fa0a0513.js";import{E as Q}from"./external-link-441fc54c.js";import"./useInfiniteQuery-28b756f2.js";import"./useMutation-cd93a773.js";import"./more-vertical-4f7086a4.js";const O=({modalId:d,results:c,driver:i})=>{const s=j(),{mutate:l,isLoading:r}=I(),o=a=>{r||l({driverId:i._id,engineId:a._id},{onError(){x({message:"une erreur s'est produite"})},onSuccess(){s.invalidateQueries(["driverProfile",i._id])}})};return e.jsxs("div",{children:[e.jsx("input",{type:"checkbox",id:d,className:"modal-toggle"}),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-box max-w-3xl space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Résultats de la recherche"}),c.length===0?e.jsx("p",{className:"text-gray-500 text-xl text-center",children:"Aucun engin trouvé."}):e.jsx("div",{children:c.map(a=>e.jsxs("div",{className:"flex",children:[e.jsx("img",{src:a.photos[0].src,alt:"",className:"w-20 rounded-lg aspect-ratio-square"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("div",{className:"font-medium mb-1",children:a.name}),e.jsx("button",{onClick:()=>o(a),className:"btn btn-primary",children:"attachez"})]})]},a._id))}),e.jsx("div",{className:"modal-action",children:e.jsx("label",{htmlFor:d,className:"btn btn-ghost btn-active rounded-xl",children:"fermer"})})]})})]})},B=({driver:d})=>{const c="search-results",[i,s]=m.useState(""),[l,r]=m.useState(!1),[o,a]=m.useState([]),t=async()=>{if(i.trim().length===0){x({message:"Veuillez saisir une plaque d'immatriculation"});return}r(!0);try{const n=await M({licencePlate:i});n&&a([n]),g(c,"open")}catch(n){console.log(n),x({message:"une erreur s'est produite"})}r(!1)};return e.jsxs("div",{id:"licence-plate-search",className:"bg-white shadow-lg rounded-xl p-4 space-y-4",children:[e.jsx("h4",{className:"first-letter:uppercase font-medium",children:"attachez un engin"}),e.jsx("input",{type:"text",className:"input input-ghost w-full bg-gray-100",placeholder:"Recherchez par matricule",value:i,onChange:n=>s(n.target.value)}),e.jsx("button",{onClick:t,className:h("btn btn-ghost btn-block bg-stone-200",{loading:l}),children:"recherchez"}),e.jsx(O,{modalId:c,results:o,driver:d})]})},re=()=>{const{driverId:d}=p(),{hasEngineAttatched:c}=k(),i=[{path:"",label:"Courses"},{path:"reviews",label:"Avis & notes"},{path:"debts",label:"Dettes"}],{data:s,isLoading:l,isError:r,refetch:o}=E({driverId:d}),a=()=>A({origin:s.lastKnownLocation.coordinates});return e.jsx("div",{id:"driver-profile-page",children:e.jsxs("div",{className:"container mx-auto px-4",children:[l&&e.jsx(v,{}),!l&&r&&e.jsx(N,{tryAgain:o}),!l&&!r&&!s&&e.jsx(f,{}),!l&&!r&&s&&e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"font-bold mb-6",children:"Profil chauffeur"}),e.jsxs("div",{className:"grid gap-6 grid-cols-12",children:[e.jsxs("div",{className:"col-span-4 space-y-4",children:[e.jsxs("div",{className:"shadow-lg p-4 rounded-lg space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.photo.src,onClick:()=>b({images:[s.photo.src]}),className:"w-28 h-28 rounded-full",alt:""})}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex flex-1",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-2xl",children:y(s.firstName,s.lastName)}),e.jsx(C,{status:s.status})]})}),e.jsx(R,{driver:s})]}),e.jsxs("div",{className:"space-y-2 text-stone-600 text-lg",children:[e.jsxs("div",{className:"flex items-center text-lg",children:[e.jsx(_,{}),e.jsx("div",{className:"ml-2",children:w(s.creationDate).format("DD MMMM YYYY HH:mm")})]}),e.jsxs("div",{className:"flex items-center text-lg",children:[e.jsx(q,{}),e.jsx("div",{className:"ml-2",children:s._id})]}),e.jsxs("div",{className:"flex items-center text-lg",children:[e.jsx(F,{}),e.jsx("div",{className:"ml-2",children:s.password})]}),s.phones.map(t=>e.jsxs("div",{className:"flex items-center text-lg",children:[e.jsx(K,{}),e.jsx("div",{className:"ml-2",children:t})]},t)),e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"text-amber-500"}),e.jsxs("div",{className:"ml-2",children:[s.total.rating," (",s.total.reviews," avis)"]})]}),e.jsxs("div",{children:[s.total.completedRides," transport terminés"]})]}),s.lastKnownLocation&&e.jsxs("a",{href:a(),target:"_blank",className:"btn btn-ghost btn-active",children:[e.jsx("span",{className:"mr-2",children:"ouvrir la dernière localisation connue"}),e.jsx(Y,{size:20})]})]}),!c(s)&&e.jsx(B,{driver:s}),s.engine&&e.jsxs("div",{className:"shadow-lg p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"mb-2",children:"Engin"}),e.jsx(z,{driver:s})]}),e.jsx(D,{to:`/engines/details/${s.engineId}`,children:e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsxs("div",{className:"flex flex-1 items-center",children:[e.jsx("img",{src:s.engine.firstPhoto.src,className:"w-20 h-20 rounded-xl",alt:""}),e.jsxs("div",{className:"ml-2",children:[e.jsx("div",{className:"font-medium text-gray-700",children:s.engine.name}),e.jsx("div",{className:"text-blue",children:s.engine.year}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{className:"border-2 border-stone-300 py-1 px-2 rounded-lg inline-flex",children:s.engine.licencePlate})})]})]}),e.jsx(Q,{className:"text-gray-700",size:20})]})})]}),e.jsxs("div",{className:"shadow-lg p-4 rounded-lg",children:[e.jsx("h4",{className:"mb-2",children:"IDs"}),e.jsx("div",{className:"grid gap-2 grid-cols-3",children:s.ids.map(t=>e.jsx("div",{children:e.jsx(S,{src:t.src,className:"rounded-lg aspect-ratio-square"})},t._id))})]})]}),e.jsxs("div",{className:"col-span-8 space-y-6",children:[e.jsx("div",{className:"tabs",children:i.map((t,n)=>e.jsx(L,{to:t.path,end:!0,className:({isActive:u})=>h("tab flex-1 tab-lg tab-lifted",{"tab-active":u}),children:t.label},n))}),e.jsx("div",{children:e.jsx(P,{})})]})]})]})]})})};export{re as default};
