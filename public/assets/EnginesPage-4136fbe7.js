import{R as o,j as e,h as y,e as p,c as E,E as x,m as j,t as u,z as w,D as L,F as A,B as P,G as S}from"./index-199c3c1b.js";import{s as k,u as C,a as F}from"./EnginesQueries-1d32232e.js";import{E as M,a as R}from"./EngineStatus-4827826b.js";import{G as _}from"./GridList-d4291e7c.js";import"./useInfiniteQuery-28b756f2.js";import"./more-vertical-4f7086a4.js";import"./external-link-441fc54c.js";import"./chevron-right-7a9ede92.js";const T=({engine:s})=>{const i=`/engines/details/${s._id}`;return e.jsxs("div",{className:"shadow-lg p-4 bg-white rounded-lg cursor-pointer hover:ease-in-out hover:duration-200 hover:ring-2 hover:ring-offset-4 hover:ring-primary",children:[e.jsxs("div",{className:"flex mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-stone-400",children:y(s.creationDate).format("DD MMMM YYYY HH:mm")})]}),e.jsx(M,{engine:s})]}),e.jsx(p,{to:i,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"border-2 border-stone-300 py-1 px-2 rounded-lg inline-flex",children:s.licencePlate}),e.jsx("div",{className:"text-blue text-lg",children:s.year})]}),e.jsx("div",{className:"-mx-4",children:e.jsx("img",{src:s.firstPhoto.src,alt:"",className:"aspect-ratio-square"})}),e.jsxs("div",{children:[s.total.completedRides," transport terminés"]}),e.jsx(R,{status:s.status})]})})]})},z=o.memo(T),D=({modalId:s,results:i,setResults:l})=>{const n=({detail:{id:t,action:d}})=>{s==t&&d=="close"&&l([])};return o.useEffect(()=>(x.on("ModalAction",n),()=>{x.remove("ModalAction",n)}),[]),e.jsxs("div",{children:[e.jsx("input",{type:"checkbox",id:s,className:"modal-toggle"}),e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-box max-w-3xl space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Résultats de la recherche"}),i.length===0?e.jsx("p",{className:"text-gray-500 text-xl text-center",children:"Aucun engin trouvé."}):e.jsx("div",{children:i.map(t=>e.jsx(p,{to:`/engines/details/${t._id}`,children:e.jsxs("div",{className:"flex cursor-pointer",children:[e.jsx("img",{src:t.photos[0].src,alt:"",className:"w-16 rounded-lg aspect-ratio-square"}),e.jsx("div",{className:"ml-2",children:e.jsx("div",{className:"font-medium",children:t.name})})]})},t._id))}),e.jsx("div",{className:"modal-action",children:e.jsx("label",{onClick:()=>j(s,"close"),className:"btn btn-ghost btn-active rounded-xl",children:"fermer"})})]})})]})},q=()=>{const s="search-results",[i,l]=o.useState(""),[n,t]=o.useState(!1),[d,c]=o.useState([]),m=async()=>{if(i.trim().length===0){u({message:"Veuillez saisir une plaque d'immatriculation"});return}t(!0);try{const r=await k({licencePlate:i});r&&c([r]),j(s,"open")}catch(r){console.log(r),u({message:"une erreur s'est produite"})}t(!1)};return e.jsxs("div",{id:"licence-plate-search",className:"bg-white shadow-lg rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"first-letter:uppercase font-medium",children:"recherche"}),e.jsx("input",{type:"text",className:"input input-ghost w-full bg-gray-100",placeholder:"Recherchez par matricule",value:i,onChange:r=>l(r.target.value)}),e.jsx("button",{onClick:m,className:E("btn btn-ghost btn-block bg-stone-200",{loading:n}),children:"recherchez"}),e.jsx(D,{modalId:s,results:d,setResults:c})]})},U=()=>{const{filters:s,setFilter:i}=w(),[l,n]=o.useState({...s}),{data:t}=C(),{data:d,isLoading:c,isError:m,refetch:r,hasNextPage:g,fetchNextPage:v,isFetchingNextPage:N}=F({filters:s}),h=a=>{n(b=>({...b,[a.target.name]:a.target.value.trim()}))},f=()=>{i({...l})};return e.jsx("div",{id:"engines-page",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("h1",{className:"font-bold first-letter:uppercase mb-8",children:"gestion des engins"}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{children:[c&&e.jsx(L,{}),!c&&m&&e.jsx(A,{tryAgain:r}),!c&&!m&&e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-9",children:[e.jsx("h2",{className:"font-semibold mb-4 first-letter:uppercase",children:"liste"}),e.jsx(_,{data:d,renderElements:a=>e.jsx(z,{engine:a},a._id),fetchNextPage:v,isFetchingNextPage:N,hasNextPage:g,className:"grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"})]}),e.jsxs("div",{className:"col-span-3 space-y-4",children:[e.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"first-letter:uppercase font-medium",children:"filtres"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-stone-500",children:"statut"}),e.jsxs("select",{onChange:h,name:"status",value:l.status,className:"select select-primary w-full",children:[e.jsx("option",{value:"",children:"tous"}),Object.values(P).map(a=>e.jsx("option",{value:a,children:S(a)},a))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-stone-500",children:"type"}),e.jsxs("select",{onChange:h,name:"engineType",value:l.engineType,className:"select select-primary w-full",children:[e.jsx("option",{value:"",children:"tous"}),t.map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-stone-500",children:"année"}),e.jsx("input",{type:"number",name:"year",value:l.year,onChange:h,className:"input input-primary w-full",placeholder:"Année example: 2016"})]}),e.jsx("div",{children:e.jsx("button",{onClick:f,className:"btn btn-primary btn-block",children:"appliquez"})})]}),e.jsx(q,{})]})]})})]})]})})};export{U as default};
