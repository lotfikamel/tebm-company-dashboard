import{R as o,j as s,c as v,E as x,e as p,g as j,h as f,m as g,t as u,i as b,k as y,D,F as w,l as M,n as S}from"./index-199c3c1b.js";import{f as A,u as E}from"./DriversQueries-a5088660.js";import{u as R}from"./EnginesQueries-1d32232e.js";import{u as C}from"./usePermissions-b517b115.js";import{D as _,a as k}from"./DriverStatus-3e26416c.js";import{I}from"./Image-81e31aa5.js";import{S as Y}from"./star-d66c6535.js";import{G as L}from"./GridList-d4291e7c.js";import"./useInfiniteQuery-28b756f2.js";import"./useMutation-cd93a773.js";import"./more-vertical-4f7086a4.js";import"./external-link-441fc54c.js";import"./chevron-right-7a9ede92.js";const T=({modalId:e,results:r,setResults:l})=>{const c=({detail:{id:a,action:n}})=>{e==a&&n=="close"&&l([])};return o.useEffect(()=>(x.on("ModalAction",c),()=>{x.remove("ModalAction",c)}),[]),s.jsxs("div",{children:[s.jsx("input",{type:"checkbox",id:e,className:"modal-toggle"}),s.jsx("div",{className:"modal",children:s.jsxs("div",{className:"modal-box max-w-3xl space-y-4",children:[s.jsx("h3",{className:"font-semibold",children:"Résultats de la recherche"}),r.length===0?s.jsx("p",{className:"text-gray-500 text-xl text-center",children:"Aucun chauffeur trouvé."}):s.jsx("div",{children:r.map(a=>s.jsx(p,{to:`/drivers/profile/${a._id}`,children:s.jsxs("div",{className:"flex cursor-pointer",children:[s.jsx("img",{src:a.photo.src,alt:"",className:"w-16 rounded-full aspect-ratio-square"}),s.jsxs("div",{className:"ml-2",children:[s.jsx("div",{className:"font-medium",children:j(a.firstName,a.lastName)}),s.jsxs("div",{className:"text-stone-400",children:["depuis ",f(a.creationDate).format("DD MMMM YYYY HH:mm")]})]})]})},a._id))}),s.jsx("div",{className:"modal-action",children:s.jsx("label",{onClick:()=>g(e,"close"),className:"btn btn-ghost btn-active rounded-xl",children:"fermer"})})]})})]})},F=()=>{const e="search-results",[r,l]=o.useState(""),[c,a]=o.useState(!1),[n,d]=o.useState([]),m=async()=>{if(r.trim().length===0){u({message:"Veuillez saisir un code chauffeur"});return}a(!0);try{const i=await A({driverId:r});i&&d([i]),g(e,"open")}catch(i){console.log(i),u({message:"une erreur s'est produite"})}a(!1)};return s.jsxs("div",{id:"licence-plate-search",className:"bg-white shadow-lg rounded-xl p-6 space-y-4",children:[s.jsx("h3",{className:"first-letter:uppercase font-medium",children:"recherche"}),s.jsx("input",{type:"text",className:"input input-ghost w-full bg-gray-100",placeholder:"Recherchez par code",value:r,onChange:i=>l(i.target.value)}),s.jsx("button",{onClick:m,className:v("btn btn-ghost btn-block bg-stone-200",{loading:c}),children:"recherchez"}),s.jsx(T,{modalId:e,results:n,setResults:d})]})},P=({driver:e})=>{const r=`/drivers/profile/${e._id}`,{isDriverInactive:l}=C();return s.jsxs("div",{className:"bg-white p-4 cursor-pointer shadow-lg rounded-xl hover:ease-in-out hover:duration-200 hover:ring-2 hover:ring-offset-4 hover:ring-primary",children:[s.jsxs("div",{className:"flex mb-2",children:[s.jsxs("div",{className:"flex flex-1",children:[s.jsx(I,{src:e.photo.src,className:"w-12 h-12 rounded-full"}),s.jsxs("div",{className:"ml-2",children:[s.jsx("div",{className:"font-medium",children:j(e.firstName,e.lastName)}),s.jsx("div",{className:"text-sm text-stone-400",children:f(e.creationDate).format("DD MMMM YYYY HH:mm")})]})]}),!l(e)&&s.jsx(_,{driver:e})]}),s.jsxs(p,{to:r,children:[s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{children:b(e._id)}),s.jsx("div",{className:"text-stone-500",children:e.phone}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(Y,{size:20,className:"text-amber-500"}),s.jsxs("span",{className:"ml-1 text-stone-500",children:[e.total.rating," (",e.total.reviews," avis)"]})]}),s.jsxs("div",{className:"text-stone-500",children:[e.total.completedRides," transport terminés"]})]}),s.jsx(k,{status:e.status})]})]})},z=o.memo(P),Z=()=>{const{filters:e,setFilter:r}=y(),{data:l}=R(),{data:c,isLoading:a,isError:n,refetch:d,hasNextPage:m,fetchNextPage:i,isFetchingNextPage:N}=E({filters:e}),h=t=>{r({[t.target.name]:t.target.value.trim()})};return s.jsx("div",{id:"drivers-page",children:s.jsxs("div",{className:"container mx-auto px-4",children:[s.jsx("h1",{className:"font-bold first-letter:uppercase mb-8",children:"gestion des chauffeurs"}),s.jsx("hr",{className:"my-6"}),s.jsxs("div",{children:[a&&s.jsx(D,{}),!a&&n&&s.jsx(w,{tryAgain:d}),!a&&!n&&s.jsx("div",{children:s.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[s.jsxs("div",{className:"col-span-9",children:[s.jsx("h2",{className:"font-semibold mb-4 first-letter:uppercase",children:"liste"}),s.jsx(L,{data:c,renderElements:t=>s.jsx(z,{driver:t},t._id),fetchNextPage:i,isFetchingNextPage:N,hasNextPage:m,className:"grid-cols-2 sm:grid-cols-3 md:grid-cols-3 gap-4"})]}),s.jsxs("div",{className:"col-span-3 space-y-4",children:[s.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-6 space-y-4",children:[s.jsx("h3",{className:"first-letter:uppercase font-medium",children:"filtres"}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-2 text-stone-500",children:"statut"}),s.jsxs("select",{onChange:h,name:"status",value:e.status,className:"select select-primary w-full",children:[s.jsx("option",{value:"",children:"tous"}),Object.values(M).map(t=>s.jsx("option",{value:t,children:S(t)},t))]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-2 text-stone-500",children:"type"}),s.jsxs("select",{onChange:h,name:"engineType",value:e.engineType,className:"select select-primary w-full",children:[s.jsx("option",{value:"",children:"tous"}),l.map(t=>s.jsx("option",{value:t._id,children:t.name},t._id))]})]})]}),s.jsx(F,{})]})]})})]})]})})};export{Z as default};
