import{I as N,R as m,j as s,c as b,E as x,e as y,m as g,t as p,D as T,F as R,J as S,K as w}from"./index-199c3c1b.js";import{M as A,a as C,T as E,f as M,b as L,u as F}from"./TransportRideStatus-c86ef4d7.js";import{u as P}from"./EnginesQueries-1d32232e.js";import{T as _}from"./TransportRide-b7f2b7cf.js";import{G as k}from"./GridList-d4291e7c.js";import"./useInfiniteQuery-28b756f2.js";import"./chevron-right-7a9ede92.js";const j={filters:{engineType:"",status:""}},z=N((e,t)=>({...j,setFilter:i=>e(n=>({filters:{...n.filters,...i}})),reset:()=>e(j)})),I=({modalId:e,results:t,setResults:i})=>{const n=({detail:{id:a,action:c}})=>{e==a&&c=="close"&&i([])};return m.useEffect(()=>(x.on("ModalAction",n),()=>{x.remove("ModalAction",n)}),[]),s.jsxs("div",{children:[s.jsx("input",{type:"checkbox",id:e,className:"modal-toggle"}),s.jsx("div",{className:"modal",children:s.jsxs("div",{className:"modal-box max-w-3xl space-y-4",children:[s.jsx("h3",{className:"font-semibold",children:"Résultats de la recherche"}),t.length===0?s.jsx("p",{className:"text-gray-500 text-xl text-center",children:"Aucune course trouvée."}):s.jsx("div",{children:t.map(a=>s.jsx(y,{to:`/rides/details/${a._id}`,children:s.jsxs("div",{className:"space-y-1 p-4 bg-white shadow-lg rounded-xl",children:[s.jsx("div",{className:"font-medium",children:a._id}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(A,{size:18}),s.jsx("span",{className:"ml-2",children:a.originAddress})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(C,{size:18}),s.jsx("span",{className:"ml-2",children:a.destinationAddress})]}),s.jsx(E,{status:a.status})]})},a._id))}),s.jsx("div",{className:"modal-action",children:s.jsx("label",{onClick:()=>g(e,"close"),className:"btn btn-ghost btn-active rounded-xl",children:"fermer"})})]})})]})},D=()=>{const e="search-results",[t,i]=m.useState(""),[n,a]=m.useState(!1),[c,d]=m.useState([]),h=async()=>{if(t.trim().length===0){p({message:"Veuillez saisir un ID course"});return}a(!0);try{const l=await M({rideId:t});l&&d([l]),g(e,"open")}catch(l){console.log(l),p({message:"une erreur s'est produite"})}a(!1)};return s.jsxs("div",{id:"licence-plate-search",className:"bg-white shadow-lg rounded-xl p-6 space-y-4",children:[s.jsx("h3",{className:"first-letter:uppercase font-medium",children:"recherche"}),s.jsx("input",{type:"text",className:"input input-ghost w-full bg-gray-100",placeholder:"Recherchez par code",value:t,onChange:l=>i(l.target.value)}),s.jsx("button",{onClick:h,className:b("btn btn-ghost btn-block bg-stone-200",{loading:n}),children:"recherchez"}),s.jsx(I,{modalId:e,results:c,setResults:d})]})},o=({title:e,stat:t})=>s.jsx("div",{className:"stats shadow",children:s.jsxs("div",{className:"stat",children:[s.jsx("div",{className:"stat-title",children:e}),s.jsx("div",{className:"stat-value",children:t})]})}),Q=()=>{const{data:e,isLoading:t,isError:i}=L();return t||i?null:s.jsxs("div",{className:"grid gap-4 grid-cols-4",children:[s.jsx(o,{title:"Courses terminées",stat:e.all}),s.jsx(o,{title:"Courses terminées aujourd'hui",stat:e.today}),s.jsx(o,{title:"Courses terminées ce mois-ci",stat:e.thisMonth}),s.jsx(o,{title:"Courses terminées cette année",stat:e.thisYear})]})},$=()=>{const e=w(),{filters:t,setFilter:i}=z(),{data:n=[]}=P(),{data:a=[],isLoading:c,isError:d,refetch:h,hasNextPage:l,fetchNextPage:f,isFetchingNextPage:v}=F({filters:t}),u=r=>{i({[r.target.name]:r.target.value.trim()})};return s.jsx("div",{id:"rides-page",children:s.jsxs("div",{className:"container mx-auto px-4",children:[s.jsx("h1",{className:"font-bold first-letter:uppercase mb-8",children:"gestion des courses de transport"}),s.jsx(Q,{}),s.jsx("hr",{className:"my-6"}),s.jsxs("div",{children:[c&&s.jsx(T,{}),!c&&d&&s.jsx(R,{tryAgain:h}),!c&&!d&&s.jsx("div",{children:s.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[s.jsxs("div",{className:"col-span-9",children:[s.jsx("h2",{className:"font-semibold mb-4 first-letter:uppercase",children:"liste"}),s.jsx(k,{data:a,renderElements:r=>s.jsx(_,{ride:r},r._id),fetchNextPage:f,isFetchingNextPage:v,hasNextPage:l,className:"grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"})]}),s.jsxs("div",{className:"col-span-3 space-y-4",children:[s.jsxs("div",{className:"bg-white shadow-lg rounded-xl p-6 space-y-4",children:[s.jsx("h3",{className:"first-letter:uppercase font-medium",children:"filtres"}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-2 text-stone-500",children:"statut"}),s.jsxs("select",{onChange:u,name:"status",value:t.status,className:"select select-primary w-full",children:[s.jsx("option",{value:"",children:"tous"}),Object.values(e).map(r=>s.jsx("option",{value:r,children:S(r)},r))]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"mb-2 text-stone-500",children:"type d'engin"}),s.jsxs("select",{onChange:u,name:"engineType",value:t.engineType,className:"select select-primary w-full",children:[s.jsx("option",{value:"",children:"tous"}),n.map(r=>s.jsx("option",{value:r._id,children:r.name},r._id))]})]})]}),s.jsx(D,{})]})]})})]})]})})};export{$ as default};
